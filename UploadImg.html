<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>demo</title>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style>
        #addImg {
            border: 1px solid red;
            height: 300px;
            width: 100px;
        }
    </style>
</head>
<body>
    <input type="button" id="btn" value="点我点我" />
    <form action="" method="post" enctype="multipart/form-data">
        <div>
            <h3>共<span id="currImgCount">0</span>张,还能上传<span id="remainingImgCount">4</span>张</h3>
            <div id="addImg"></div>
            <div id="Addfj"></div>
        </div>
        <input type="button" value="提交" onclick="javascript: alert('点击了提交!');" />
    </form>
</body>
</html>
<script>
    $(function () {
        var i = 0;//用于计数,只是一个索引,方便根据索引执行click事件
        $(document).on("click", "#btn", function () {
            if ($("#addImg").children().length >= 4) {
                alert("最多上传4张!");
                return;
            }
            i++;
            $("#Addfj").append('<div id="fileDiv2"><input type="file" name="file" id="file2" custom="' + i + '" style="display:none;" /></div>');
            $("[custom=" + i + "]").trigger("click");
        });
        $(document).on("change", "#file2", function () {
            var res = VaildImage(this);
            if (res) {
                //预览效果实现
                $("#addImg").append('<p><img src="' + URL.createObjectURL($(this)[0].files[0]) + '" class="img" style="width:50px;height:50px;"><input value="删除" onclick="javascript: del(this)"  type="button"/></p>');
                LoadCount();
            }
        });
    });
    //删除方法
    function del(obj) {
        var _currIndex = $(obj).parent().index();
        $("#Addfj").children().eq(_currIndex).remove();
        $(obj).parent().remove();
        LoadCount();
    }
    //动态计算图片数
    function LoadCount() {
        $("#currImgCount").html($("#addImg").children().length);
        $("#remainingImgCount").html(4 - $("#addImg").children().length);
    }
    function VaildImage(obj) {
        console.log($(obj)[0].files[0].size / 1024 + "KB");//输出当前图片大小的,单位KB
        console.log($(obj)[0].files[0].type);//输出文件类型
        var currSize = $(obj)[0].files[0].size / 1024;
        var currType = $(obj)[0].files[0].type;
        if (currSize > 1024)//就1兆吧
        {
            alert("文件大小不能超过1兆！");
            $(obj).parent().remove();
            return false;
        }
        //这里的判断可以改成数组形式或者多加几个判断也行
        if (currType != "image/jpeg") {
            alert("请上传JPG图片,其他格式暂不支持！");
            $(obj).parent().remove();
            return false;
        }
        return true;
    }
</script>
